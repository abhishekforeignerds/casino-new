<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Modern Roulette Betting Game (Counter-Rotated Cards)</title>
    <style>
        :root {
            --primary-color: #e91e63;
            --background-color: #f7f7f7;
            --chip-gradient: linear-gradient(145deg, #ff80ab, #f50057);
            --chip-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }


        /* Balance Display */
        #image-roulette #balance-display {
            font-size: 1.75rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }



        #image-roulette #coin-container {
            margin-bottom: 25px;
        }

        #image-roulette .coin {
            font-size: 1.2rem;
            padding: 12px 20px;
            margin: 0 8px;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            background: var(--chip-gradient);
            box-shadow: var(--chip-shadow);
            color: #fff;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #image-roulette .coin:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }

        #image-roulette .coin.selected {
            outline: 3px solid var(--primary-color);
            transform: scale(1.1);
        }

        /* Main Container */
        #image-roulette #main-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            margin-bottom: 30px;
        }

        /* Wheel Container (350x350) */
        #image-roulette #wheel-container {
            position: relative;
            width: 350px;
            height: 350px;
            border-radius: 50%;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        /* Rotating Wheel */
        #image-roulette #wheel {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
            z-index: 10;
        }

        /* SVG layers */
        #image-roulette #segments-svg,
        #image-roulette #lines-svg {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        #image-roulette #lines-svg {
            z-index: 15;
        }

        /* Card wrapper */
        #image-roulette .card-wrapper {
            position: absolute;
            transform-origin: center;
        }

        /* Card */
        #image-roulette .card {
            width: 40px;
            height: 50px;
            display: block;
            box-shadow: var(--card-shadow);
            transform-origin: center;
        }

        /* Center Circle */
        #image-roulette #center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #fff;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 25;
        }

        /* Marker */
        #image-roulette #marker {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 21px solid transparent;
            border-right: 21px solid transparent;
            border-bottom: 28px solid var(--primary-color);
            z-index: 30;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
        }

        /* Card Grid */
        #image-roulette #card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            max-width: 300px;
        }

        #image-roulette .grid-card {
            position: relative;
            width: 60px;
            height: 90px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: transform 0.2s;
        }

        #image-roulette .grid-card:hover {
            transform: scale(1.05);
        }

        #image-roulette .grid-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.8;
        }

        /* Bet Overlay */
        #image-roulette .bet-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1rem;
            font-weight: bold;
            background: rgba(233, 30, 99, 0.9);
            color: #fff;
            padding: 4px 8px;
            border-radius: 12px;
            pointer-events: none;
        }

        /* Winner Animation */
        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        #image-roulette .winner {
            animation: blink 1s infinite;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
        }

        /* Spin Button */
        #image-roulette #spinBtn {
            padding: 12px 25px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 50px;
            background: var(--primary-color);
            color: #fff;
            box-shadow: var(--chip-shadow);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #image-roulette #spinBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }

        /* History Box */
        #image-roulette #history-box {
            margin-top: 30px;
            max-width: 350px;
            border: 2px solid var(--primary-color);
            padding: 10px;
            background: #fff;
        }

        #image-roulette #history-box h3 {
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 1.2rem;
        }

        #image-roulette #history-container {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            justify-content: center;
        }

        #image-roulette .history-card {
            width: 40px;
            height: 50px;
            box-shadow: var(--card-shadow);
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div id="image-roulette">
        <!-- Balance Display -->
        <div id="balance-display">Balance: 1000</div>
        <!-- Coin Buttons -->
        <div id="coin-container">
            <button class="coin" data-value="10">10</button>
            <button class="coin" data-value="20">20</button>
            <button class="coin" data-value="100">100</button>
        </div>
        <!-- Main Container: Wheel and Grid -->
        <div id="main-container">
            <!-- Wheel Container -->
            <div id="wheel-container">
                <div id="wheel">
                    <!-- SVG segments and lines -->
                    <svg id="segments-svg" width="350" height="350"></svg>
                    <svg id="lines-svg" width="350" height="350"></svg>
                    <!-- Card wrappers -->
                    <!-- Each wrapper is positioned absolutely.
             The card inside has its inline counter-rotation. -->
                    <div class="card-wrapper" style="left:154px; top:4px;" data-initial-rotation="171">
                        <img class="card" src="https://deckofcardsapi.com/static/img/AS.png" alt="Ace of Spades"
                            style="transform: rotate(171deg);">
                    </div>
                    <div class="card-wrapper" style="left:224px; top:22px;" data-initial-rotation="205">
                        <img class="card" src="https://deckofcardsapi.com/static/img/KH.png" alt="King of Hearts"
                            style="transform: rotate(205deg);">
                    </div>
                    <div class="card-wrapper" style="left:275px; top:74px;" data-initial-rotation="245">
                        <img class="card" src="https://deckofcardsapi.com/static/img/QC.png" alt="Queen of Clubs"
                            style="transform: rotate(245deg);">
                    </div>
                    <div class="card-wrapper" style="left:294px; top:144px;" data-initial-rotation="272">
                        <img class="card" src="https://deckofcardsapi.com/static/img/JD.png" alt="Jack of Diamonds"
                            style="transform: rotate(272deg);">
                    </div>
                    <div class="card-wrapper" style="left:275px; top:214px;" data-initial-rotation="298">
                        <img class="card" src="https://deckofcardsapi.com/static/img/0S.png" alt="Ten of Spades"
                            style="transform: rotate(298deg);">
                    </div>
                    <div class="card-wrapper" style="left:224px; top:265px;" data-initial-rotation="327">
                        <img class="card" src="https://deckofcardsapi.com/static/img/2C.png" alt="Two of Clubs"
                            style="transform: rotate(327deg);">
                    </div>
                    <div class="card-wrapper" style="left:154px; top:284px;" data-initial-rotation="3">
                        <img class="card" src="https://deckofcardsapi.com/static/img/3D.png" alt="Three of Diamonds"
                            style="transform: rotate(3deg);">
                    </div>
                    <div class="card-wrapper" style="left:84px; top:265px;" data-initial-rotation="30">
                        <img class="card" src="https://deckofcardsapi.com/static/img/4H.png" alt="Four of Hearts"
                            style="transform: rotate(30deg);">
                    </div>
                    <div class="card-wrapper" style="left:33px; top:214px;" data-initial-rotation="61">
                        <img class="card" src="https://deckofcardsapi.com/static/img/5S.png" alt="Five of Spades"
                            style="transform: rotate(61deg);">
                    </div>
                    <div class="card-wrapper" style="left:14px; top:144px;" data-initial-rotation="98">
                        <img class="card" src="https://deckofcardsapi.com/static/img/6C.png" alt="Six of Clubs"
                            style="transform: rotate(98deg);">
                    </div>
                    <div class="card-wrapper" style="left:33px; top:74px;" data-initial-rotation="116">
                        <img class="card" src="https://deckofcardsapi.com/static/img/7D.png" alt="Seven of Diamonds"
                            style="transform: rotate(116deg);">
                    </div>
                    <div class="card-wrapper" style="left:84px; top:22px;" data-initial-rotation="153">
                        <img class="card" src="https://deckofcardsapi.com/static/img/8H.png" alt="Eight of Hearts"
                            style="transform: rotate(153deg);">
                    </div>
                </div>
                <!-- Center Circle -->
                <div id="center-circle"></div>
                <!-- Marker -->
                <div id="marker"></div>
            </div>
            <!-- Card Grid -->
            <div id="card-grid">
                <div class="grid-card" data-index="0">
                    <img src="https://deckofcardsapi.com/static/img/AS.png" alt="Ace of Spades">
                </div>
                <div class="grid-card" data-index="1">
                    <img src="https://deckofcardsapi.com/static/img/KH.png" alt="King of Hearts">
                </div>
                <div class="grid-card" data-index="2">
                    <img src="https://deckofcardsapi.com/static/img/QC.png" alt="Queen of Clubs">
                </div>
                <div class="grid-card" data-index="3">
                    <img src="https://deckofcardsapi.com/static/img/JD.png" alt="Jack of Diamonds">
                </div>
                <div class="grid-card" data-index="4">
                    <img src="https://deckofcardsapi.com/static/img/0S.png" alt="Ten of Spades">
                </div>
                <div class="grid-card" data-index="5">
                    <img src="https://deckofcardsapi.com/static/img/2C.png" alt="Two of Clubs">
                </div>
                <div class="grid-card" data-index="6">
                    <img src="https://deckofcardsapi.com/static/img/3D.png" alt="Three of Diamonds">
                </div>
                <div class="grid-card" data-index="7">
                    <img src="https://deckofcardsapi.com/static/img/4H.png" alt="Four of Hearts">
                </div>
                <div class="grid-card" data-index="8">
                    <img src="https://deckofcardsapi.com/static/img/5S.png" alt="Five of Spades">
                </div>
                <div class="grid-card" data-index="9">
                    <img src="https://deckofcardsapi.com/static/img/6C.png" alt="Six of Clubs">
                </div>
                <div class="grid-card" data-index="10">
                    <img src="https://deckofcardsapi.com/static/img/7D.png" alt="Seven of Diamonds">
                </div>
                <div class="grid-card" data-index="11">
                    <img src="https://deckofcardsapi.com/static/img/8H.png" alt="Eight of Hearts">
                </div>
            </div>
        </div>
        <button id="spinBtn">Spin</button>

        <!-- History Box: Last 12 cards that landed on the marker -->
        <div id="history-box">
            <h3>Last 12 Winning Cards</h3>
            <div id="history-container"></div>
        </div>
    </div>
    <script>
        // CONFIGURABLE VARIABLES
        const segmentCount = 12;
        const segmentAngle = 360 / segmentCount; // 30° each
        let segmentOffset = -15; // Adjust segment boundaries

        // For the 350px wheel container:
        const centerX = 175, centerY = 175, outerRadius = 175, innerRadius = 28;

        // Draw alternating segments
        function drawSegments() {
            const svg = document.getElementById("segments-svg");
            svg.innerHTML = '';
            for (let i = 0; i < segmentCount; i++) {
                const startDeg = segmentOffset + i * segmentAngle;
                const endDeg = startDeg + segmentAngle;
                const startRad = startDeg * Math.PI / 180;
                const endRad = endDeg * Math.PI / 180;
                const x1 = centerX + outerRadius * Math.cos(startRad);
                const y1 = centerY + outerRadius * Math.sin(startRad);
                const x2 = centerX + outerRadius * Math.cos(endRad);
                const y2 = centerY + outerRadius * Math.sin(endRad);
                const d = `M ${centerX} ${centerY} L ${x1} ${y1} A ${outerRadius} ${outerRadius} 0 0 1 ${x2} ${y2} Z`;
                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute("fill", i % 2 === 0 ? "red" : "black");
                path.setAttribute("d", d);
                svg.appendChild(path);
            }
        }

        // Draw radial boundary lines
        function drawLines() {
            const svg = document.getElementById("lines-svg");
            svg.innerHTML = '';
            for (let i = 0; i < segmentCount; i++) {
                const angleDeg = segmentOffset + i * segmentAngle;
                const angleRad = angleDeg * Math.PI / 180;
                const x1 = centerX + innerRadius * Math.cos(angleRad);
                const y1 = centerY + innerRadius * Math.sin(angleRad);
                const x2 = centerX + outerRadius * Math.cos(angleRad);
                const y2 = centerY + outerRadius * Math.sin(angleRad);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x1);
                line.setAttribute("y1", y1);
                line.setAttribute("x2", x2);
                line.setAttribute("y2", y2);
                line.setAttribute("stroke", "rgba(0,0,0,0.5)");
                line.setAttribute("stroke-width", "2");
                svg.appendChild(line);
            }
        }
        drawSegments();
        drawLines();

        // Calculate winning index based on current rotation
        function getWinningIndex(rotationAngle) {
            const r = rotationAngle % 360;
            const effectiveAngle = (360 - r + segmentAngle / 2 - segmentOffset) % 360;
            return Math.floor(effectiveAngle / segmentAngle);
        }

        let currentRotation = 0;
        let balance = 1000;
        let selectedCoin = null;
        const bets = {};

        const balanceDisplay = document.getElementById("balance-display");
        function updateBalanceDisplay() {
            balanceDisplay.textContent = "Balance: " + balance;
        }
        updateBalanceDisplay();

        // Coin selection
        document.querySelectorAll(".coin").forEach(btn => {
            btn.addEventListener("click", function () {
                document.querySelectorAll(".coin").forEach(b => b.classList.remove("selected"));
                this.classList.add("selected");
                selectedCoin = parseInt(this.getAttribute("data-value"));
            });
        });

        // Place bet on grid cell when clicked
        document.querySelectorAll(".grid-card").forEach(card => {
            card.addEventListener("click", function () {
                const index = this.getAttribute("data-index");
                if (bets[index] !== undefined) return;
                if (selectedCoin === null) return;
                if (balance < selectedCoin) return;
                balance -= selectedCoin;
                updateBalanceDisplay();
                bets[index] = selectedCoin;
                const overlay = document.createElement("div");
                overlay.className = "bet-overlay";
                overlay.textContent = selectedCoin;
                this.appendChild(overlay);
            });
        });

        // Helper: Add winning card to history box (keep max 12)
        function addHistoryCard(src) {
            const historyContainer = document.getElementById("history-container");
            const img = document.createElement("img");
            img.src = src;
            img.classList.add("history-card");
            historyContainer.appendChild(img);
            if (historyContainer.childNodes.length > 12) {
                historyContainer.removeChild(historyContainer.firstChild);
            }
        }

        // Spin event: rotate the entire wheel.
        // Because each card is in a wrapper, we update the wheel's transform.
        // In the card wrapper, we also update the counter-rotation so the card's net rotation remains as originally set.
        document.getElementById("spinBtn").addEventListener("click", function () {
            const wheel = document.getElementById("wheel");
            // Remove blinking class from all grid cards
            document.querySelectorAll(".grid-card").forEach(card => card.classList.remove("winner"));
            const deltaAngle = 3600 + Math.floor(Math.random() * 360);
            currentRotation += deltaAngle;
            wheel.style.transform = "rotate(" + currentRotation + "deg)";

            // When the spin completes (after 4 seconds), update winning bets and history.
            setTimeout(() => {
                // Update each card's counter rotation (if needed)
                document.querySelectorAll(".card-wrapper").forEach(wrapper => {
                    const initial = parseFloat(wrapper.dataset.initialRotation);
                    let cardRotation = initial - (currentRotation % 360);
                    cardRotation = ((cardRotation % 360) + 360) % 360;
                    // Uncomment below if you wish to update the card image transform:
                    // wrapper.querySelector(".card").style.transform = "rotate(" + cardRotation + "deg)";
                });

                const winningIndex = getWinningIndex(currentRotation);
                const winningCardEl = document.querySelector(`.grid-card[data-index="${winningIndex}"]`);
                // Always blink the winning card
                winningCardEl.classList.add("winner");

                // If the user placed a bet on this winning card, calculate and add winnings.
                if (bets[winningIndex] !== undefined) {
                    const betAmount = bets[winningIndex];
                    const winnings = betAmount * 2;
                    balance += winnings;
                }
                updateBalanceDisplay();

                // Add the winning card image to the history box.
                const winningCardImgSrc = winningCardEl.querySelector("img").src;
                addHistoryCard(winningCardImgSrc);

                // Remove all bet overlays and reset bets
                document.querySelectorAll(".bet-overlay").forEach(overlay => overlay.remove());
                for (let key in bets) delete bets[key];
            }, 4000);
        });
    </script>
</body>

</html>